# Kamal 2 Staging Deployment Configuration
# Deploy with: kamal deploy -d staging

service: email-classifier

image: infotrader/email-classifier

servers:
  web:
    hosts:
      - 5.78.113.32
    options:
      memory: 512m

proxy:
  ssl: true
  host: classifier-staging.infotrader.aero
  app_port: 8000
  healthcheck:
    path: /health
    interval: 3
    timeout: 10

deploy_timeout: 30

registry:
  username: infotrader
  password:
    - KAMAL_REGISTRY_PASSWORD

builder:
  arch: amd64

ssh:
  user: root

env:
  clear:
    MODEL_PATH: /app/models/email_classifier.pkl
  secret:
    - API_KEY

volumes:
  - /opt/email-classifier/models:/app/models:ro

logging:
  driver: json-file
  options:
    max-size: 100m
    max-file: 3
